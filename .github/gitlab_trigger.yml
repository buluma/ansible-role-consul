---
name: Mirror and run GitLab CI
true:
  push:
    branches:
      - master
      - main
      - testing
    paths-ignore:
      - '**/README.md'
      - '**/CHANGELOG.md'
concurrency:
  cancel-in-progress: true
  group: ${{ github.ref }}-${{ github.workflow }}
jobs:
  build:
    env:
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
    runs-on: ubuntu-latest
    steps:
      - if: always()
        uses: act10ns/slack@v1
        with:
          channel: '#ansible'
          message: Starting buluma.consul GitLab Trigger...
          status: starting
      - uses: actions/checkout@v4
      - env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITLAB_HOSTNAME: gitlab.com
          GITLAB_PASSWORD: ${{ secrets.GITLAB_PASSWORD }}
          GITLAB_PROJECT_ID: 3340722x
          GITLAB_USERNAME: buluma
        name: Mirror + trigger CI
        uses: buluma/gitlab-mirror-ci-action@1.0.7
        with:
          args: buluma/ansible-role-consul
      - if: always()
        name: Slack Notification
        uses: act10ns/slack@v1
        with:
          channel: '#ansible'
          status: ${{ job.status }}
          steps: ${{ toJson(steps) }}
